%% TO find the psuedoaccelerations on body fixed frame

clc;
close all;
clear all;


%%

filename = 'tf.csv';
A = csvread(filename, 1, 0);
gt_t   = A(:,1);
gtPos  = A(:,2:4);
gt_ang = A(:,5:7); 
gt_dt  = mean(gradient(gt_t)); % almost constant ros rate
gt_t   = gt_t - gt_t(1);

n = 150;
gtVel(:,1) = smooth(gradient(gtPos(:,1))/gt_dt, n);
gtVel(:,2) = smooth(gradient(gtPos(:,2))/gt_dt, n);
gtVel(:,3) = smooth(gradient(gtPos(:,3))/gt_dt, n);

gtAcc(:,1) = smooth(gradient(gtVel(:,1))/gt_dt, n);
gtAcc(:,2) = smooth(gradient(gtVel(:,2))/gt_dt, n);
gtAcc(:,3) = smooth(gradient(gtVel(:,3))/gt_dt, n);

figure;
plot(gtPos(:,1), gtPos(:,2)); axis equal; grid on;
hold on; plot(Gate3(1), Gate3(2), 'xr');
text(gtPos(1,1), gtPos(1,2), "start");
text(gtPos(end,1), gtPos(end,2), "end");

%% 
Gate1 = ([-0.009051204, -34.8755, 3.071861] + [-0.008949876, -32.9505, 3.071861] + [-0.008949876, -32.9505, 1.134362] + [-0.009051204, -34.8755, 1.134362])/4;
Gate13 = ([1.237332, 9.001728, 2.9625] + [3.162332, 9.001728, 2.9625] + [3.162332, 9.001728, 1.025] + [1.237332, 9.001728, 1.025])/4;
Gate3 = ([-0.3703381, -12.99827, 4.728] + [-0.3699976, -11.45827, 4.728] + [-0.3699976, -11.45827, 3.177999] + [-0.3703381, -12.99827, 3.177999])/4;
Gate4 = ([-31.56487, -13.929, 6.99714] + [-30.04735, -13.929, 7.259325] + [-29.78347, -13.929, 5.731955] + [-31.30098, -13.929, 5.469769])/4;
Gate5 = ([-20.94317, 14.607, 2.515013] + [-20.94283, 16.147, 2.515013] + [-20.94283, 16.147, 0.965013] + [-20.94317, 14.607, 0.965013])/4;
Gate7 = ([16.2506, 41.63, 11.32092] + [17.79061, 41.63, 11.32092] + [17.79061, 41.63, 9.770914] + [16.2506, 41.63, 9.770914])/4;
Gate8 = ([-3.430186, 11.79953, 6.122593] + [-3.430186, 12.97997, 6.122593] + [-3.430186, 11.79952, 4.911986] + [-3.430186, 12.97997, 4.911986])/4;
Gate9 = ([-6.40867, -12.13678, 4.152941] + [-8.208672, -12.13678, 4.152941] + [-6.408669, -12.13678, 2.306941] + [-8.208672, -12.13678, 2.306941])/4;
Gate10 = ([18.15111, 3.631447, 7.229498] + [16.35111, 3.63155, 7.229498] + [18.15111, 3.631447, 5.383497] + [16.35111, 3.63155, 5.383497])/4;
Gate11 = ([-27.01367, 2.543159, 7.515942] + [-28.81367, 2.543289, 7.515942] + [-27.01367, 2.543159, 5.669941] + [-28.81367, 2.543289, 5.669941])/4;
Gate12 = ([18.40823, 13.60605, 9.143385] + [16.33437, 14.09245, 9.143507] + [18.90706, 15.73291, 9.14324] + [16.83319, 16.21931, 9.143364])/4;
Gate23 = ([-9.328671, 7.773174, 2.942941] + [-11.12867, 7.773277, 2.942941] + [-9.328669, 7.773174, 1.096941] + [-11.12867, 7.773277, 1.096941])/4;
Gate6 = ([-9.14867, 30.62316, 3.820941] + [-10.94867, 30.62329, 3.820941] + [-9.148668, 30.62316, 1.974941] + [-10.94867, 30.62329, 1.974941])/4;
Gate2 = ([0.8248205, 27.86797, 4.16025] + [3.834821, 27.86797, 4.16025] + [3.834821, 27.86797, 0.9327497] + [0.8248205, 27.86797, 0.9327497])/4;
Gate14 = ([-8.674376, -29.53623, 4.25625] + [-6.545984, -27.40784, 4.25625] + [-6.545984, -27.40784, 1.02875] + [-8.674376, -29.53623, 1.02875])/4;
Gate15 = ([5.744822, -11.79203, 4.16025] + [8.75482, -11.79203, 4.16025] + [8.75482, -11.79203, 0.9327497] + [5.744822, -11.79203, 0.9327497])/4;
Gate16 = ([-13.73218, 28.64197, 12.65825] + [-13.73218, 26.23396, 12.65825] + [-13.73218, 26.23396, 10.07625] + [-13.73218, 28.64197, 10.07625])/4;
Gate17 = ([-20.57, -13.29803, 3.46425] + [-20.57, -15.70603, 3.46425] + [-20.57, -15.70603, 0.8822498] + [-20.57, -13.29803, 0.8822498])/4;
Gate18 = ([13.51782, 21.76397, 3.61825] + [13.51782, 19.35596, 3.61825] + [13.51782, 19.35596, 1.03625] + [13.51782, 21.76397, 1.03625])/4;
Gate19 = ([15.96136, -17.26184, 12.31488] + [18.36892, -17.26184, 12.36067] + [18.41802, -17.26184, 9.779139] + [16.01046, -17.26184, 9.733349])/4;
Gate20 = ([-25.39118, 25.019, 7.856133] + [-22.98318, 25.019, 7.856133] + [-22.98318, 25.019, 5.274133] + [-25.39118, 25.019, 5.274133])/4;
Gate21 = ([15.68563, 38.50578, 8.376249] + [17.81402, 40.63416, 8.376249] + [17.81402, 40.63416, 5.14875] + [15.68563, 38.50578, 5.14875])/4;
Gate22 = ([4.803625, -27.37584, 4.18125] + [6.932016, -29.50423, 4.18125] + [6.932016, -29.50423, 0.9537499] + [4.803625, -27.37584, 0.9537499])/4;
%%
for i = 1:1:23
    gatestr = sprintf("Gate%d", i);
    gatedata = eval(gatestr);
    plot3(gatedata(1), gatedata(2), gatedata(3), 'xr');
    text(gatedata(1), gatedata(2), gatedata(3), gatestr);
    hold on;
    axis square;
end
    

